<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<script>
    // 函数式编程  编程范式 js 多范式语言 FP
    //f(x) = y;
    // 纯函数 ：纯函数是对给定的输入返还相同输出的函数


    // 一、纯函数
    // 不是纯函数；
    // let factor = 2;
    // const total = (num)=>num * factor;
    // console.log(total(3));

    // 纯函数；1.无副作用（提高复用性）; 2.可推理性（写测试）3.可读性
    // const total  = (a,b)=>a * b;
    // console.log(total(3,2));
    // const total = (num)=>num * 2;
    // test("total(3)",()=>{
    //     expect(total(3)).toBe(6);
    // })
    //不可变数据
    // let obj = {
    //     myname:"张三",
    //     age:20
    // }
    // Object.freeze(obj);


    // 高阶函数 :优点 1.声明式编程（提倡，抽象，复用）注重结果，忽略过程，”做了什么“ 2.命令式编程（怎么做，注重过程）。
    // 命令式
    // let arr = ["张三","李四","王二"];
    // for(let i=0;i<arr.length;i++){
    //     console.log(i,arr[i]);
    // }

    // 声明式 抽象过程 复用性提高；
    // const forEach = function(arr,fn){
    //     for(let i=0;i<arr.length;i++){
    //         fn && fn(arr[i],i);
    //     }
    // }
    // forEach(arr,function(item,key){
    //     console.log(item,key);
    // })
    // map
    // const map = function(arr,fn){
    //     let resArr = [];
    //     for(let val of arr){
    //         resArr.push(fn(val));
    //     }
    //     return resArr;
    // }
    // let arr = ["张三","李四","王二"];
    // let res =  map(arr,function(item){
    //     console.log(item);
    //     return item;
    // })
    // console.log(res);

    // 2.结合闭包 缓存特性 惰性执行； 
    // 一个函数 只能执行一次；
    // const once = function(fn){
    //     let done = false;
    //     return function(){
    //         if(!done){
    //             fn();
    //             done = true;
    //         }else{
    //             console.log("函数已经执行");
    //         }
    //     }
    // }

    // function test(){
    //     console.log("test");
    // }

    // let myTest = once(test);
    // myTest();
    // myTest();
    // myTest();

    // 柯里化curry：将多元函数转换成一元函数
    // let fn = (x,y)=>x+y;
    // // console.log( fn(2,3));
    // //2各参数的柯里化；
    // const curry = function(fn){
    //     return function(x){
    //         return function(y){
    //             return fn(x,y);
    //         }
    //     }
    // }
    // const curryFn = curry(fn);
    // console.log( curryFn(2)(3));
    // fn(2)(3);
    // 多个参数柯里化
    // let fn = (x,y,z)=>x+y+z;
    // // console.log(fn.length)
    const curry = function (fn) {
        return function curryFn(...args) {
            if (args.length < fn.length) {
                return function () {
                    return curryFn(...args, ...arguments)
                }
            }
            // console.log("调用完成",args);
            return fn(...args);
        }
    }

    // // 1 --- 1,2 --- 1,2,3  --- 参数的数量 和 函数参数数量一样 执行函数
    // // fn(1)(2)(3);
    // let curryFn = curry(fn);
    // let res =  curryFn(1)(2)(3);
    // console.log(res);

    // let fn = (x,y,z)=>x+y+z;  实现如下调用 curryFn(1)(2)(3)

    // 组合（compose）和管道（pipe）；管道符 ”|“
    // const aFn = function(a){
    //     return a*2;
    // }
    // const bFn = function(b){
    //     return b+3
    // }
    // // 组合：执行顺序是从右至左执行的；
    // // 管道：执行顺序是从左至右执行的；
    // // 2个参数的compose
    // const compose = function(fn1,fn2){
    //     return function(arg){
    //         return fn1(fn2(arg));
    //     }
    // }

    // let abFn = compose(bFn,aFn);
    // let res =  abFn(2);
    // console.log(res);

    // let res =  bFn(aFn(2));
    // console.log(res);

    const map = function (fn, arr) {
        let resArr = [];
        for (let val of arr) {
            resArr.push(fn(val));
        }
        return resArr;
    }

    const filter = function (fn, arr) {
        let resArr = [];
        for (let val of arr) {
            if (fn && fn(val)) {
                resArr.push(val);
            }
        }
        return resArr;
    }



    // function mapFilter() {
    //     let res = map(arr, (item) => {
    //         item.checked = true;
    //         return item;
    //     })
    //     let result = filter(res, item => {
    //         return item.age > 22;
    //     })
    //     console.log(result);
    // }


    const compose = function (fn1, fn2) {
        return function (arg) {
            return fn1(fn2(arg));
        }
    }

    // 组合一个新功能的函数 （有复用性）;
    // 把函数处理成一元；
    const curryMap = curry(map)(function (item) {
        item.checked = true;
        return item;
    })
    const curryFilter = curry(filter)(function (item) {
        return item.age > 22;
    })

    let newMapFilter = compose(curryFilter,curryMap);

    let arr = [
        {
            myname: "张三",
            age: 20
        },
        {
            myname: "李四",
            age: 30
        }, {
            myname: "王五",
            age: 23
        }
    ]
    let res = newMapFilter(arr);
    console.log(res);

















</script>

</html>